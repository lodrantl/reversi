#:kivy 1.9.1
#:import Stanje igra.Stanje
#:import hex kivy.utils.get_color_from_hex

ScreenManager:
    MeniZaslon:
        name: 'meni'
        deska: igra_zaslon.deska
    NastavitveZaslon:
        name: 'nastavitve'
        deska: igra_zaslon.deska
    IgraZaslon:
        id: igra_zaslon
        name: 'igra'
    PravilaZaslon:
        name: 'pravila'

<MeniZaslon>:
    RelativeLayout:
        canvas:
            Color:
                rgba: app.tema.ozadje
            Rectangle:
                size: self.size
                pos: self.pos
        IzbirnikBarve:
            barva: 'oranzna'
            prikazna_barva: hex('#FF5722')
            pos: 0,0
        IzbirnikBarve:
            barva: 'modra'
            prikazna_barva: hex('#3F51B5')
            pos: 0,'16sp'
        IzbirnikBarve:
            barva: 'svetla'
            prikazna_barva: hex('#FFFFFF')
            pos: 0,'32sp'
        Label:
            text: '[b]REVERSI[/b]'
            markup: True
            font_name: 'grafika/koliko-Bold.ttf'
            color: app.tema.senca
            font_size: '80sp'
            size_hint: None, None
            size: '447sp', '70sp'
            pos_hint: {'center_x': 0.5, 'center_y': 0.89}
        Label:
            text: '[b]REVERSI[/b]'
            markup: True
            font_name: 'grafika/koliko-Bold.ttf'
            color: app.tema.poudarjeno
            font_size: '80sp'
            size_hint: None, None
            size: '447sp', '70sp'
            pos_hint: {'center_x': 0.495, 'center_y': 0.895}
        LepGumb:
            text: 'EN IGRALEC'
            on_release: root.manager.current = 'nastavitve'
            pos_hint: {'center_x': 0.5, 'center_y': 0.72}
        LepGumb:
            text: 'DVA IGRALCA'
            on_release: root.deska.nova_igra()
            on_release: root.manager.current = 'igra'
            pos_hint: {'center_x': 0.5, 'center_y': 0.52}
        LepGumb:
            text: 'PRAVILA'
            on_release: root.manager.current = 'pravila'
            pos_hint: {'center_x': 0.5, 'center_y': 0.32}
        LepGumb:
            text: 'IZHOD'
            on_release: app.stop()
            pos_hint: {'center_x': 0.5, 'center_y': 0.12}

<NastavitveZaslon>:
    RelativeLayout:
        canvas:
            Color:
                rgba: app.tema.ozadje
            Rectangle:
                size: self.size
                pos: self.pos
        Label:
            text: '[b]NASTAVITVE[/b]'
            markup: True
            font_name: 'grafika/koliko-Bold.ttf'
            color: app.tema.senca
            font_size: '70sp'
            size_hint: None, None
            size: '447sp', '60sp'
            pos_hint: {'center_x': 0.5, 'center_y': 0.9}
        Label:
            text: '[b]NASTAVITVE[/b]'
            markup: True
            font_name: 'grafika/koliko-Bold.ttf'
            color: app.tema.poudarjeno
            font_size: '70sp'
            size_hint: None, None
            size: '447sp', '60sp'
            pos_hint: {'center_x': 0.495, 'center_y': 0.905}
        Label:
            color: app.tema.tekst_ozadje
            text: '[b]IGRAJ KOT:[/b]'
            markup: True
            font_size: '40sp'
            size_hint: None, None
            size: self.texture_size
            pos_hint: {'center_x': 0.5, 'center_y': 0.8}
        BoxLayout:
            pos_hint: {'center_x': 0.5, 'center_y': 0.65}
            size_hint_y: None
            height: '100sp'
            orientation: 'horizontal'
            spacing: '10sp'
            BoxSpacing
            LepRadio:
                size_hint: 0.5, 1
                text: '\u010Drni'
                value: Stanje.CRNO
                group: 'barva'
                state: 'down'
            LepRadio:
                size_hint: 0.5, 1
                text: 'beli'
                value: Stanje.BELO
                group: 'barva'
            BoxSpacing
        Label:
            color: app.tema.tekst_ozadje
            text: '[b]TE\u017DAVNOST:[/b]'
            markup: True
            font_size: '40sp'
            size_hint: None, None
            size: self.texture_size
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        BoxLayout:
            pos_hint: {'center_x': 0.5, 'center_y': 0.35}
            size_hint_y: None
            height: '100sp'
            orientation: 'horizontal'
            spacing: '10sp'
            BoxSpacing
            LepRadio:
                size_hint: 0.33, 1
                text: 'lahko'
                group: 'tezavnost'
                value: 0
            LepRadio:
                size_hint: 0.33, 1
                text: 'srednje'
                group: 'tezavnost'
                state: 'down'
                value: 1
            LepRadio:
                size_hint: 0.33, 1
                text: 'te\u017Eko'
                group: 'tezavnost'
                value: 2
            BoxSpacing
        LepGumb:
            text: 'NAZAJ'
            height: '80sp'
            on_release: root.manager.current = 'meni'
            pos_hint: {'center_x': 0.25, 'center_y': 0.1}
        LepGumb:
            text: 'IGRAJ'
            height: '80sp'
            on_release: root.deska.nova_igra(root.radio_vrednost('tezavnost'), root.radio_vrednost('barva'))
            on_release: root.manager.current = 'igra'
            pos_hint: {'center_x': 0.75, 'center_y': 0.1}

<IgraZaslon>:
    deska: deska
    BoxLayout:
        canvas:
            Color:
                rgba: app.tema.ozadje
            Rectangle:
                size: self.size
                pos: self.pos
        orientation: 'vertical'
        spacing: '10sp'
        RelativeLayout:
            size_hint: 1, None
            height: '70sp'
            BarvniLabel:
                text: root.deska.ime_belega
                font_size: '30sp'
                size_hint_x: None
                width: '170sp'
                state: 'down' if root.deska.na_potezi == Stanje.BELO else 'normal'
                pos_hint: {'center_x': 0.2, 'center_y': 0.5}
            Zeton:
                source: 'grafika/beli_zeton.png'
                pos_hint: {'center_x': 0.45, 'center_y': 0.5}
            Label:
                color: 0,0,0,1
                font_size: '23sp'
                text: str(root.deska.stevilo_belih)
                pos_hint: {'center_x': 0.45, 'center_y': 0.5}
            Zeton:
                source: 'grafika/crni_zeton.png'
                pos_hint: {'center_x': 0.55, 'center_y': 0.5}
            Label:
                color: 1, 1, 1, 1
                text: str(root.deska.stevilo_crnih)
                font_size: '23sp'
                pos_hint: {'center_x': 0.55, 'center_y': 0.5}
            BarvniLabel:
                text: root.deska.ime_crnega
                font_size: '30sp'
                size_hint_x: None
                width: '170sp'
                state: 'down' if root.deska.na_potezi == Stanje.CRNO else 'normal'
                pos_hint: {'center_x': 0.8, 'center_y': 0.5}
        AnchorLayout:
            size_hint_y: None
            height: self.parent.height - sp(170)
            Deska:
                id: deska
                manager: root.manager
        RelativeLayout:
            size_hint_y: None
            height: '65sp'
            LepGumb:
                text: 'RAZVELJAVI'
                font_size: '27sp'
                omogocen: root.deska.obstaja_zgodovina
                on_release: root.deska.razveljavi()
                size: '170sp', '65sp'
                pos_hint: {'center_x': 0.25, 'center_y': 0.5}
            LepGumb:
                text: 'KON\u010CAJ IGRO'
                font_size: '27sp'
                on_release: root.deska.koncaj_igro_popup()
                size: '170sp', '65sp'
                pos_hint: {'center_x': 0.75, 'center_y': 0.5}
        BoxSpacing

<Polje>
    canvas.before:
        Color:
            rgba: app.tema.deska_rob
        Rectangle:
            size: self.size
            pos: self.pos
        Color:
            rgba: app.tema.deska
        Rectangle:
            size: self.width * (14 / 15), self.height * (14 / 15)
            pos: self.x + self.width *(1 / 30), self.y + self.height *(1 / 30)
        Color:
            rgba: app.tema.ozadje  if root.stanje == Stanje.MOGOCE and root.mozno == '' else [0, 0, 0, 0]
        Ellipse:
            size: self.width * (1 / 6), self.height * (1 / 6)
            pos: self.center_x - self.width *(1 / 12), self.center_y - self.height *(1 / 12)
    size_hint: 0.125, 0.125

    Image:
        color:
            [1, 1, 1, 1] if (root.stanje == Stanje.BELO or root.stanje == Stanje.CRNO) else \
            [1, 1, 1, 0.5] if root.mozno else [0, 0, 0, 0]
        source:
            'grafika/beli_zeton.png' if (root.stanje == Stanje.BELO or root.mozno == Stanje.BELO) else \
            ('grafika/crni_zeton.png' if (root.stanje == Stanje.CRNO or root.mozno == Stanje.CRNO) else 'grafika/prazno.png')
        #source: 'grafika/' + root.stanje + root.stil + '.png'
        mipmap: True

<Deska>
    size_hint: None, None
    velikost: min(self.parent.width, self.parent.height) - sp(10)
    size: self.velikost, self.velikost
    canvas.before:
        Color:
            rgba: app.tema.deska_rob
        Rectangle:
            size: self.width + sp(10), self.height + sp(10)
            pos: - sp(5), -sp(5)

<PravilaZaslon>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Pravila'
            font_size: '20sp'
        Label:
            text: 'TODO: indepth rule explanation'
            font_size: '12sp'
        Button:
            text: 'Back'
            on_release: root.manager.current = 'meni'

<LepWidget@Widget>:
    color: app.tema.tekst_locila
    background_color: 0, 0, 0, 0
    izbrana_barva: app.tema.ozadje_svetlo
    state: 'normal'
    font_size: '35sp'
    omogocen: True
    canvas.before:
        Color:
            rgba: app.tema.onemogoceno if not self.omogocen else app.tema.locila
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: app.tema.ozadje
        Rectangle:
            pos: self.x + sp(3), self.y + sp(3)
            size: self.width - sp(6), self.height - sp(6)
        Color:
            rgba: app.tema.onemogoceno if not self.omogocen else (self.izbrana_barva if self.state == 'down' else app.tema.locila)
        Rectangle:
            pos: self.x + sp(6), self.y + sp(6)
            size: self.width - sp(12), self.height - sp(12)

<LepRadio@LepWidget+ToggleButton>:
    size_hint: None, None
    size: '154sp', '100sp'
    izbrana_barva: app.tema.poudarjeno
    allow_no_selection: False

<LepGumb@LepWidget+Button>:
    size_hint: None, None
    izbrana_barva: app.tema.ozadje_svetlo
    size: '231sp', '90sp'

<Zeton@Image>:
    size_hint: None, None
    size: '65sp', '65sp'

<BarvniLabel@LepWidget+Label>:
    izbrana_barva: app.tema.poudarjeno

<PonoviIgroPopup>
    background_color: 0,0,0,0
    size_hint: None, None
    size: '440sp', '220sp'
    sporocila: {Stanje.NEODLOCENO: 'NEODLO\u010CENO', Stanje.BELO: 'ZMAGA BELI', Stanje.CRNO: 'ZMAGA \u010CRNI'}
    auto_dismiss: False
    BoxLayout
        orientation: 'vertical'
        spacing: '10sp'
        canvas.before:
            Color:
                rgba: app.tema.ozadje_temno
            Rectangle:
                size: self.size
                pos: self.pos
        Label:
            color: app.tema.tekst_ozadje_temno
            text: '[b][size=35sp]{}[/size]\n[size=25sp]\u017Deli\u0161 igrati ponovno?[/size][/b]'.format(root.sporocila[root.deska.igra.zmagovalec()])
            markup: True
            text_size: self.size
            halign: 'center'
            valign: 'center'
        RelativeLayout
            LepGumb:
                text: 'Glavni meni'
                size: '180sp', '70sp'
                pos_hint: {'center_x': 0.25, 'center_y': 0.5}
                on_release: root.deska.koncaj_igro()
                on_release: root.dismiss()
                font_size: '30sp'
            LepGumb:
                text: 'Igraj znova'
                size: '180sp', '70sp'
                pos_hint: {'center_x': 0.75, 'center_y': 0.5}
                on_release: root.deska.ponovi_igro()
                on_release: root.dismiss()
                font_size: '30sp'
        BoxSpacing

<KoncajIgroPopup>
    background_color: 0,0,0,0
    size_hint: None, None
    size: '440sp', '180sp'
    auto_dismiss: False
    BoxLayout
        orientation: 'vertical'
        spacing: '20sp'
        canvas.before:
            Color:
                rgba: app.tema.ozadje_temno
            Rectangle:
                size: self.size
                pos: self.pos
        Label:
            color: app.tema.tekst_ozadje_temno
            text: '[b]Ste prepri\u010Dani?[/b]'
            markup: True
            font_size: '35sp'
            size: self.texture_size
        RelativeLayout
            LepGumb:
                text: 'Prekli\u010Di'
                size: '180sp', '70sp'
                pos_hint: {'center_x': 0.25, 'center_y': 0.5}
                on_release: root.dismiss()
                font_size: '30sp'
            LepGumb:
                text: 'Zapusti igro'
                size: '180sp', '70sp'
                pos_hint: {'center_x': 0.75, 'center_y': 0.5}
                on_release: root.deska.koncaj_igro()
                on_release: root.dismiss()
                font_size: '30sp'
        BoxSpacing

<BoxSpacing@Widget>:
    size_hint: None, None
    size: 0, 0

<Label>:
    font_name: 'grafika/Qontra.otf'

<IzbirnikBarve@Button>:
    size_hint: None, None
    size: '16sp', '16sp'
    background_color: 0,0,0,0
    prikazna_barva: 0, 0, 0, 0
    canvas.before:
        Color:
            rgba: hex('#505050')
        Rectangle:
            size: self.size
            pos: self.pos
        Color:
            rgba: self.prikazna_barva
        Rectangle:
            size: self.width - sp(1), self.height - sp(1)
            pos: self.x, self.y
    on_press: app.tema.nastavi(self.barva)